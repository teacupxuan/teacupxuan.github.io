---
title: 数据库客户端查不到写入的数据排查方法
date: 2025-9-6 22:32:31
tags:
  - 数据库
categories:
  - 技术分享
description: 揭晓了为什么数据库客户端查不到写入的数据的原因。
---

最近我在上班时遇到了两个个问题：
- 我自测时调用接口给PostgreSQL写入数据，但是我在DBeaver刷新了很久都刷不出来我新写入的数据。但过了一会再次刷新时，就可以看见刚刚插入的数据，创建时间也是我调用接口的时间。
- 同时我还写入了Redis中，但是在Tiny Redis就刷新不出来，在Another Redis Desktop Manager就可以正确刷新出来。
这两个问题都可以归类为数据库客户端查不到刚刚写入的数据，我对此进行了搜寻资料和询问AI，得到了以下方法来排查和解决该类问题。

##### 为什么DBeaver 要刷新很久才能看到？

有以下几个常见原因：

###### 1. DBeaver 的查询结果是缓存的
- DBeaver不会实时展示数据库的变化，它只会显示上一次执行SQL的结果。
- 你必须手动点击“刷新”或重新执行`SELECT` 才能看到最新数据。
- 所以，你看到的“延迟”，其实是因为你没重新查，而不是数据库没写进去。

###### 2. 事务隔离级别的影响
- 如果你在 DBeaver 里开了一个事务（很多时候默认就是自动开事务），查询结果可能不会立即反映最新写入的数据，除非：
	- 事务提交（`commit`）
	- 或者你开了一个新的会话去查
- 特别是PostgreSQL、MySQL InnoDB 默认的 **可重复读 / 读已提交** 隔离级别，会导致当前会话看不到别的事务刚刚提交的数据。

→检查一下 DBeaver 状态栏是不是显示 `Auto-commit`？如果没开，记得 `commit`。

###### 3. 查询条件 / 排序问题
- 有时候你在 DBeaver 的 SQL 里用了缓存的 SQL（比如 `SELECT * FROM xxx LIMIT 100`），它可能没把最新插入的行查出来，导致你以为数据没写进去。
- 建议你加上 `ORDER BY create_time DESC`，就能保证最新的数据在最上面。

总结：你的数据其实已经实时写进数据库了，只是 DBeaver 默认不会“实时刷新”，再加上事务隔离/查询条件的影响，让你觉得要等很久才能看到。

##### DBeaver刷新看不到数据的排查方法

1. 先确认是不是**缓存**（重新跑SQL）。
2. 再看**事务模式**（Auto-commit vs 手动）。
3. 看**事务隔离级别**。
4. 检查**SQL查询条件**。


##### Tiny RDB查不到最新数据，但ARDM能查到最新数据的原因?

###### 1. 连接质量问题
- Tiny RDB 可能没有做连接池优化，网络稍微不稳定时，`SCAN` 的响应就容易卡住或丢失。
- 如果 Redis 部署在云端（比如阿里云/腾讯云），Tiny RDB 的超时配置比 ARDM 更敏感，就会导致「刷新半天没出来」。

###### 2. 全量扫描性能差
- Redis 没有 `SELECT *` 这种操作，客户端需要用 `SCAN` 扫描所有 key。
- ARDM 的做法是：**异步分批加载**，你一边能看到旧数据，一边后台继续扫。
- Tiny RDB 的做法是：**阻塞式扫描**，要等扫到一批才能展示 → 如果 db0 里 key 数量很多，就会显得「刷不出来」。

###### 3. UI / 渲染优化不足
- ARDM 有缓存 + 虚拟列表渲染，即使 Redis 有 10w key，它也能瞬间展示一部分。
- Tiny RDB 没有优化，key 一多就卡顿，表现为「看不到新数据」。

###### 4. 解决办法
1. 在 Tiny RDB 里不要用「刷新所有 key」，直接 **搜索具体的 key**（这样只发一个 `GET`，不会卡）。
2. 如果一定要浏览，尝试调小「每批次加载的 key 数量」（有些客户端能设置 `scan count`）。
3. 遇到不稳定，可以先用 `redis-cli` 验证数据是否存在，避免怀疑是 Redis 本身的问题。
4. 如果是日常开发调试，建议还是用 **Another Redis Desktop Manager** 或者 **RedisInsight**，它们对大 key 空间更友好。


这次问题也让我明白了，那么多数据库可视化客户端为什么有的很出名，甚至要收费用比如 Navicat，为什么有的无人问津。这是因为他们在处理数据库连接和可视化展示，刷新等方式有着很大的不同，同时在性能上也有很大差异！
